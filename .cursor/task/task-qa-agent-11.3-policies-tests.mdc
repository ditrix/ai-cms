# Задача 11.3: Тесты для Policies

## Ответственный агент
**qa_agent**

## Этап
Этап 11: Тестирование

## Зависимости
- Задача 3.1 (ClientPolicy) - должна быть завершена
- Задача 3.2 (UserPolicy) - должна быть завершена

## Описание
Создать feature тесты для проверки прав доступа через Policies.

## Файлы для создания
- `tests/Feature/ClientPolicyTest.php` (новый файл)
- `tests/Feature/UserPolicyTest.php` (новый файл)

## Требования

### ClientPolicyTest:
1. **Менеджер:**
   - `viewAny()` - возвращает true, но фильтрует только своих клиентов
   - `view()` - true только для своих клиентов, false для чужих
   - `create()` - true
   - `update()` - true только для своих клиентов, false для чужих
   - `delete()` - true только для своих клиентов, false для чужих

2. **Супер-менеджер и Админ:**
   - Все методы возвращают true для всех клиентов

### UserPolicyTest:
1. **Менеджер:**
   - Все методы возвращают false (нет доступа к операциям с менеджерами)

2. **Супер-менеджер и Админ:**
   - `viewAny()` - true
   - `view()` - true
   - `create()` - true
   - `update()` - true
   - `delete()` - true
   - `changePassword()` - true
   - `changeManager()` - true

### Использование:
- Pest PHP для написания тестов
- Factories для создания тестовых данных
- `actingAs()` для авторизации пользователей с разными ролями
- `Gate::allows()` и `Gate::denies()` для проверки прав

## Ссылки на документацию
- См. `PLAN.mdc` - Задача 11.3
- См. `ARC.mdc` - раздел 8 (Тестирование)
- Использовать `search-docs` для Pest PHP и Laravel Policies Testing

## Критерии приемки
- [ ] Файл `tests/Feature/ClientPolicyTest.php` создан
- [ ] Файл `tests/Feature/UserPolicyTest.php` создан
- [ ] Реализованы тесты для всех методов Policies
- [ ] Тесты проверяют права доступа для всех ролей
- [ ] Все тесты проходят успешно (`php artisan test`)
- [ ] Код соответствует стандартам Pest PHP
- [ ] Задача задокументирована в `workflow.mdc`

## Примечания
Тесты можно писать параллельно с разработкой контроллеров
